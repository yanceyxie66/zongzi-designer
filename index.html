<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>创意粽子工坊</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f7f7f7; margin: 0; padding: 20px; box-sizing: border-box; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 8px Vercel.app30px rgba(0,0,0,0.1); text-align: center; width: 100%; max-width: 500px; box-sizing: border-box; }
        h1 { color: #333; font-size: 1.8em; margin-bottom: 25px; }
        .step { text-align: left; margin-bottom: 20px; }
        .step-label { display: block; margin-bottom: 10px; font-weight: bold; color: #555; font-size: 1.1em; }
        select, input[type="text"], button { width: 100%; padding: 12px; margin-bottom: 15px; font-size: 16px; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
        button { background-color: #007bff; color: white; cursor: pointer; border: none; font-weight: bold; transition: background-color 0.3s; margin-top: 20px; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #999; cursor: not-allowed; }
        .checkbox-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .checkbox-item { display: flex; align-items: center; background-color: #f9f9f9; padding: 10px; border-radius: 6px; cursor: pointer; transition: background-color 0.2s; }
        .checkbox-item:hover { background-color: #f0f0f0; }
        .checkbox-item input { margin-right: 10px; width: auto; accent-color: #007bff; }
        #status { color: #555; min-height: 24px; font-size: 0.9em; margin-top: 15px; }
        #result-display { margin-top: 20px; }
        #resultImage { max-width: 100%; height: auto; border-radius: 8px; border: 1px solid #eee; }
        #zongziNameDisplay { font-size: 1.3em; font-weight: bold; color: #333; margin-top: 15px; word-wrap: break-word; }
        @media (max-width: 600px) {
            body { padding: 15px; }
            .container { padding: 20px; }
            h1 { font-size: 1.5em; }
            .checkbox-group { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>创意粽子工坊</h1>

        <div class="step">
            <label class="step-label" for="base">1. 选择核心基底:</label>
            <select id="base">
                <option value="酱香糯米鲜肉">酱香糯米鲜肉 (经典咸粽)</option>
                <option value="绵密香甜红豆沙">绵密香甜红豆沙 (经典甜粽)</option>
                <option value="丝滑香芋泥">丝滑香芋泥 (新潮甜粽)</option>
                <option value="混合了紫米和燕麦的五谷米">健康五谷米 (养生风味)</option>
            </select>
        </div>

        <div class="step">
            <label class="step-label">2. 添加灵魂配料 (可多选):</label>
            <div id="ingredients" class="checkbox-group">
                <div class="checkbox-item"><input type="checkbox" value="流油的咸蛋黄">咸蛋黄</div>
                <div class="checkbox-item"><input type="checkbox" value="大块的红烧肉">红烧肉</div>
                <div class="checkbox-item"><input type="checkbox" value="鲜美的香菇">香菇</div>
                <div class="checkbox-item"><input type="checkbox" value="软糯的栗子">栗子</div>
                <div class="checkbox-item"><input type="checkbox" value="整颗的瑶柱(干贝)">瑶柱干贝</div>
                <div class="checkbox-item"><input type="checkbox" value="浓郁的黑松露酱">黑松露</div>
                <div class="checkbox-item"><input type="checkbox" value="多汁的鲍鱼">鲍鱼</div>
                <div class="checkbox-item"><input type="checkbox" value="香辣的小龙虾尾">麻辣小龙虾</div>
                <div class="checkbox-item"><input type="checkbox" value="Q弹的黑糖珍珠">黑糖珍珠</div>
                <div class="checkbox-item"><input type="checkbox" value="拉丝的芝士">拉丝芝士</div>
                <div class="checkbox-item"><input type="checkbox" value="清甜的桂花蜜">桂花蜜</div>
                <div class="checkbox-item"><input type="checkbox" value="冰凉的抹茶酱">冰凉抹茶</div>
            </div>
        </div>

        <div class="step">
            <label class="step-label" for="wrapping">3. 选择外皮与形态:</label>
            <select id="wrapping">
                <option value="翠绿的粽叶包裹，经典的三角金字塔形状">经典三角粽叶</option>
                <option value="晶莹剔透的水晶皮包裹，玲珑可爱">晶莹水晶皮</option>
                <option value="新鲜的竹叶包裹，长条枕头形状">长条枕头粽叶</option>
            </select>
        </div>

        <div class="step">
            <label class="step-label" for="zongziName">4. 为你的作品命名:</label>
            <input type="text" id="zongziName" placeholder="例如：宇宙无敌至尊粽">
        </div>

        <button id="generateBtn" onclick="generateZongzi()">开始创作！</button>
        <p id="status"></p>
        
        <div id="result-display" style="display:none;">
            <h2 id="zongziNameDisplay"></h2>
            <img id="resultImage" src="">
        </div>
    </div>

    <script>
        const generateBtn = document.getElementById('generateBtn');
        const statusEl = document.getElementById('status');
        const resultDisplayEl = document.getElementById('result-display');
        const resultImageEl = document.getElementById('resultImage');
        const zongziNameDisplayEl = document.getElementById('zongziNameDisplay');

        async function generateZongzi() {
            generateBtn.disabled = true;
            statusEl.textContent = "正在连接云端工坊，请稍候...";
            resultDisplayEl.style.display = 'none';

            // 1. 收集所有创意元素
            const base = document.getElementById('base').value;
            const wrapping = document.getElementById('wrapping').value;
            const customName = document.getElementById('zongziName').value.trim();

            const selectedIngredients = [];
            document.querySelectorAll('#ingredients input[type="checkbox"]:checked').forEach(checkbox => {
                selectedIngredients.push(checkbox.value);
            });

            // 2. 动态组合 Prompt
            let prompt = `特写镜头，一个精美的粽子，`;
            prompt += `${wrapping}，`;
            prompt += `里面是${base}基底，`;

            if (selectedIngredients.length > 0) {
                prompt += `能清晰看到里面还有${selectedIngredients.join("、")}等配料。`;
            } else {
                prompt += `馅料饱满。`;
            }
            prompt += "美食摄影, 照片级画质, 色彩鲜艳，富有食欲。";

            // 默认风格为写实
            let bodyPayload = { prompt: prompt };

            try {
                const response = await fetch('/generate-image', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(bodyPayload),
                });

                if (!response.ok) throw new Error('服务器返回错误');
                const result = await response.json();

                if (result.image) {
                    // 4. 展示作品
                    resultImageEl.src = `data:image/png;base64,${result.image}`;
                    // 如果学生没起名字，就给一个默认的
                    zongziNameDisplayEl.textContent = customName || "我的创意粽子";
                    resultDisplayEl.style.display = 'block';
                    statusEl.textContent = "创作成功！";
                } else {
                    throw new Error(result.error || "未收到图片");
                }
            } catch (error) {
                statusEl.textContent = `生成失败: ${error.message}`;
            } finally {
                generateBtn.disabled = false;
            }
        }
    </script>
</body>
</html>